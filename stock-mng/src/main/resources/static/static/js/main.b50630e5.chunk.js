(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{119:function(e,t,n){e.exports=n(209)},124:function(e,t,n){},209:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(7),s=n.n(c),o=(n(124),n(10)),i=n.n(o),l=n(17),u=n(25),d=n(26),p=n(29),h=n(27),m=n(30),f=n(212),v=n(215),g=n(213),b=n(210),w=n(2),E=n.n(w),y=n(9),k=n(211),C=n(39),x=n(214),O=function(e){return Math.min(99,Math.max(0,e))};var N=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).onChange=function(e){var t;e.target.value?(t=e.target.value,isNaN(t)||parseInt(t)!==+t||n.props.onChange(O(+e.target.value))):n.props.onChange(0)},n.increment=function(e){var t=n.props.value+e;isNaN(t)&&(t=0),n.props.onChange(O(t))},n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"number-component"},r.a.createElement(C.a,{disabled:this.props.disabled,shape:"circle",onClick:function(){return e.increment(-1)}},r.a.createElement(y.a,{type:"minus"})),r.a.createElement("span",null,r.a.createElement(x.a,{disabled:this.props.disabled,className:"input",value:this.props.value,onChange:this.onChange})),r.a.createElement(C.a,{disabled:this.props.disabled,shape:"circle",onClick:function(){return e.increment(1)}},r.a.createElement(y.a,{type:"plus"})))}}]),t}(a.Component),j=function(){},S=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e,n))).order=Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({loading:!0}),e.prev=1,e.next=4,a.props.onOrder(a.state.orderCount);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:a.setState({orderCount:0,loading:!1});case 9:case"end":return e.stop()}},e,null,[[1,6]])})),a.state={orderCount:0,loading:!1},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:E()({"stock-item":!0,enlarged:this.props.enlarged,hidden:this.props.hidden})},r.a.createElement("div",{className:"main"},r.a.createElement("div",{className:"name",onClick:this.props.enlarged?j:this.props.onEnlarge},r.a.createElement("span",{className:"return-icon",onClick:this.props.enlarged?this.props.onShrink:j},r.a.createElement(y.a,{type:"arrow-left"}))," ",this.props.name),r.a.createElement("div",{className:"price"},"\u5355\u4ef7: \xa5",(+this.props.price).toFixed(2)),this.props.loading?r.a.createElement("div",{className:"purchased"},"\xa0",r.a.createElement(b.a,{size:"small"})):r.a.createElement("div",{className:"purchased"},"\u5df2\u8d2d: ",this.props.ownedCount||0," \u4ef6")),r.a.createElement("div",{className:"side"},r.a.createElement(N,{value:this.state.orderCount,onChange:function(t){return e.setState({orderCount:t})},disabled:this.state.loading}),r.a.createElement(k.a,{placement:"left",title:"\u786e\u5b9a\u8981\u8ba2\u8d2d".concat(this.state.orderCount,"\u4ef6 ").concat(this.props.name," \u5417\uff1f (\u603b\u4ef7").concat((this.state.orderCount*this.props.price).toFixed(2),"\u5143)"),className:this.state.orderCount?"":"disabled",onConfirm:this.order},r.a.createElement(C.a,{className:"purchase-button",type:"primary",disabled:!this.state.orderCount,loading:this.state.loading},"\u8ba2\u8d2d"))),r.a.createElement("div",{className:E()({hidden:!this.props.enlarged,"item-description":!0})},this.props.description?r.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.description}}):r.a.createElement("div",{style:{opacity:.7}},"\u5546\u54c1\u6682\u65e0\u8be6\u7ec6\u8bf4\u660e")))}}]),t}(a.Component),I=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e,n))).updateCurrent=function(){a.state.current!==a.props.balance&&(Math.abs(a.state.current-a.props.balance)<.01?a.setState({current:a.props.balance}):a.setState({current:a.state.current+(a.props.balance-a.state.current)/10}))},a.state={current:a.props.balance},setInterval(a.updateCurrent,10),a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"balance-component"},"\u53ef\u7528\u4f59\u989d ",null===this.props.balance?r.a.createElement("span",null,"..."):r.a.createElement("span",null,"\xa5 ",(+this.state.current).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")))}}]),t}(a.Component),U=n(116),B=n.n(U),F=n(56),q=n.n(F);function H(e){if(!1===e.success)throw new Error("result.success===false")}function M(e){return"/"===window.backendUrl&&(window.backendUrl=window.location.origin),window.backendUrl.endsWith("/")&&(window.backendUrl=window.backendUrl.substr(0,window.backendUrl.length-1)),e.startsWith("/")||(e="/"+e),window.backendUrl+e}window.backendUrl=window.backendUrl||"/";var z={createUser:function(){var e=Object(l.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q.a.post(M("/createUser"),{userName:t});case 3:H(e.sent.data),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),v.a.error("Failed to create user: "+e.t0.message),e.t0;case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),query:function(){var e=Object(l.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q.a.post(M("/query"),{userName:t});case 3:return H(n=e.sent.data),e.abrupt("return",n);case 8:throw e.prev=8,e.t0=e.catch(0),v.a.error("Failed to query stock: "+e.t0.message),e.t0;case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),queryBalance:function(){var e=Object(l.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q.a.post(M("/queryBalance"),{userName:t});case 3:return H(n=e.sent.data),e.abrupt("return",n);case 8:throw e.prev=8,e.t0=e.catch(0),v.a.error("Failed to query balance: "+e.t0.message),e.t0;case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),purchase:function(){var e=Object(l.a)(i.a.mark(function e(t,n,a){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q.a.post(M("/purchase"),{userName:t,productCode:n,count:a});case 3:return H(r=e.sent.data),e.abrupt("return",r);case 8:throw e.prev=8,e.t0=e.catch(0),v.a.error("Failed to purchase: "+e.t0.message),e.t0;case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t,n,a){return e.apply(this,arguments)}}()},P=f.a.Header,A=f.a.Content,D=f.a.Footer,L=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e,n))).resizeHandler=function(){a.recalcEnlargedElementStyle&&a.recalcEnlargedElementStyle()},a.refreshStockItems=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.query(localStorage.userName);case 2:(t=e.sent).forEach(function(e){return e.loading=!1}),a.setState({stockItems:t});case 5:case"end":return e.stop()}},e)})),a.refreshBalance=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.queryBalance(localStorage.userName);case 2:t=e.sent,a.setState({balance:t.balance});case 4:case"end":return e.stop()}},e)})),a.onOrder=function(){var e=Object(l.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.purchase(localStorage.userName,t.productCode,n);case 2:v.a.success("\u606d\u559c\uff0c\u8ba2\u8d2d\u6210\u529f"),a.setState({balance:a.state.balance-t.price*n}),t.ownedCount+=n,t.loading=!0,a.setState({}),a.refreshStockItems(),a.refreshBalance();case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),a.state={balance:null,stockItems:null,enlargedProductCode:null},setInterval(function(){a.refreshStockItems(),a.refreshBalance()},3e3),a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.initUser();case 2:return this.refreshBalance(),e.next=5,this.refreshStockItems();case 5:window.addEventListener("resize",this.resizeHandler);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeHandler)}},{key:"render",value:function(){var e=this;return r.a.createElement(f.a,{className:"layout"},r.a.createElement(P,null,r.a.createElement("div",{className:"logo"},"KubeCon DEMO")),r.a.createElement(A,{style:{padding:"0 50px"}},r.a.createElement(g.a,{style:{margin:"16px 0"}},r.a.createElement(g.a.Item,null,"Home"),r.a.createElement(g.a.Item,null,"\u5e93\u5b58\u7ba1\u7406")),r.a.createElement("div",{style:{background:"#fff",padding:24,minHeight:280},id:"stock-item-list"},!this.state.stockItems&&r.a.createElement("div",{className:"spin-div"},r.a.createElement(b.a,null)),!!this.state.stockItems&&this.state.stockItems.map(function(t){return r.a.createElement(S,{key:t.productCode,name:t.name,description:t.description,ownedCount:t.ownedCount,price:t.price,loading:t.loading,enlarged:e.state.enlargedProductCode===t.productCode,hidden:!!e.state.enlargedProductCode&&e.state.enlargedProductCode!==t.productCode,onEnlarge:function(){return e.onEnlarge(t.productCode)},onShrink:function(){return e.onShrink()},onOrder:function(n){return e.onOrder(t,n)}})}))),r.a.createElement(I,{balance:this.state.balance}),r.a.createElement(D,{style:{textAlign:"center"}},"Alipay \xa92019 / a KubeCon DEMO"))}},{key:"onEnlarge",value:function(e){var t=this;this.setState({enlargedProductCode:e},function(){for(var e=document.getElementById("stock-item-list"),n=e.getBoundingClientRect(),a=-1,r={},c=0;c<e.children.length;c++){var s=e.children[c].getBoundingClientRect();if(e.children[c].className.indexOf("enlarged")>=0){a=c;var o=s.y-n.y-24,i=n.y+n.height-s.y-s.height-24;r[c]="margin-top:".concat(o,"px;margin-bottom:").concat(i,"px;height:").concat(s.height,"px;")}else e.children[c].className.indexOf("hidden")>=0&&(r[c]="position:absolute; width:".concat(s.width,"px; top:").concat(s.y,"px"))}Object.keys(r).forEach(function(t){e.children[t].style=r[t]}),a>=0&&(t.recalcEnlargedElementStyle=function(){var t=.35.toFixed(2)+"s",r=document.body.clientHeight-n.y-48-105;e.children[a].style="transition: opacity ".concat(t,", margin-top ").concat(t,", margin-bottom ").concat(t,", height ").concat(t,";margin-top:0; margin-bottom:0; height:").concat(r,"px")},setTimeout(t.recalcEnlargedElementStyle,350/3))})}},{key:"onShrink",value:function(){this.recalcEnlargedElementStyle=null;for(var e=document.getElementById("stock-item-list"),t=0;t<e.children.length;t++)e.children[t].style="";this.setState({enlargedProductCode:null})}}],[{key:"initUser",value:function(){var e=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.userName){e.next=6;break}return t=B()(),e.next=5,z.createUser(t);case 5:localStorage.userName=t;case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),t}(a.Component);s.a.render(r.a.createElement(L,null),document.getElementById("root"))}},[[119,1,2]]]);
//# sourceMappingURL=main.b50630e5.chunk.js.map