{"version":3,"sources":["Number.js","StockItem.js","Balance.js","Service.js","App.js","index.js"],"names":["normalizeVal","val","Math","min","max","Number","onChange","e","value","target","isNaN","parseInt","_this","props","increment","delta","_this2","this","react_default","a","createElement","className","es_button","disabled","shape","onClick","icon","type","input","Component","StockItem","context","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","order","asyncToGenerator","regenerator_default","mark","_callee","wrap","_context","prev","next","setState","loading","onOrder","state","orderCount","t0","stop","name","price","toFixed","spin","size","ownedCount","src_Number","popconfirm","placement","title","concat","onConfirm","Balance","updateCurrent","current","balance","abs","setInterval","replace","assertResult","result","success","Error","getBackendUrl","path","window","backendUrl","location","origin","endsWith","substr","length","startsWith","Service","createUser","_createUser","userName","axios","post","sent","data","message","error","_x","apply","arguments","query","_query","_callee2","_context2","abrupt","_x2","queryBalance","_queryBalance","_callee3","_context3","_x3","purchase","_purchase","_callee4","productCode","count","_context4","_x4","_x5","_x6","Header","Layout","Content","Footer","App","refreshStockItems","items","localStorage","forEach","item","stockItems","refreshBalance","_ref3","initUser","layout","style","padding","breadcrumb","margin","Item","background","minHeight","map","src_StockItem","key","src_Balance","textAlign","uuid","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.d8c7381e.chunk.js","sourcesContent":["import React, {Component} from 'react';\nimport {Button, Icon, Input} from 'antd';\n\nconst normalizeVal = val => Math.min(99, Math.max(0, val));\n\nfunction isInteger(value) {\n    return !isNaN(value) && parseInt(value) === +value;\n}\n\nclass Number extends Component {\n    onChange = e => {\n        if (!e.target.value) {\n            this.props.onChange(0);\n            return;\n        }\n        if (!isInteger(e.target.value)) {\n            return;\n        }\n        this.props.onChange(normalizeVal(+e.target.value));\n    };\n\n    increment = (delta) => {\n        let val = this.props.value + delta;\n        if (isNaN(val)) {\n            val = 0;\n        }\n        this.props.onChange(normalizeVal(val));\n    };\n\n    render() {\n        return <div className=\"number-component\">\n            <Button disabled={this.props.disabled} shape=\"circle\" onClick={() => this.increment(-1)}><Icon\n                type=\"minus\"/></Button>\n            <span>\n                <Input disabled={this.props.disabled} className=\"input\" value={this.props.value}\n                       onChange={this.onChange}/>\n            </span>\n            <Button disabled={this.props.disabled} shape=\"circle\" onClick={() => this.increment(1)}><Icon type=\"plus\"/></Button>\n        </div>\n    }\n\n}\n\nexport default Number;","import React, {Component} from 'react';\nimport {Button, Popconfirm, Spin} from 'antd';\nimport Number from \"./Number\";\n\nclass StockItem extends Component {\n\n    order = async () => {\n        this.setState({loading: true});\n        try {\n            await this.props.onOrder(this.state.orderCount);\n        } catch {\n        }\n        this.setState({orderCount: 0, loading: false});\n    };\n\n    constructor(props, context) {\n        super(props, context);\n        this.state = {\n            orderCount: 0,\n            loading: false,\n        };\n    }\n\n    render() {\n        return <div className=\"stock-item\">\n            <div className=\"main\">\n                <div className=\"name\">\n                    {this.props.name}\n                </div>\n                <div className=\"price\">\n                    单价: ¥{(+this.props.price / 100).toFixed(2)}\n                </div>\n                {this.props.loading ? <div className=\"purchased\">\n                        &nbsp;\n                        <Spin size=\"small\"/>\n                    </div> :\n                    <div className=\"purchased\">\n                        已购: {this.props.ownedCount || 0} 件\n                    </div>}\n            </div>\n            <div className=\"side\">\n                <Number value={this.state.orderCount}\n                        onChange={orderCount => this.setState({orderCount})}\n                        disabled={this.state.loading}\n                />\n                <Popconfirm\n                    placement={\"left\"}\n                    title={`确定要订购${this.state.orderCount}件 ${this.props.name} 吗？ (总价${(this.state.orderCount * this.props.price / 100).toFixed(2)}元)`}\n                    className={!this.state.orderCount ? \"disabled\" : \"\"}\n                    onConfirm={this.order}\n                >\n                    <Button\n                        className=\"purchase-button\"\n                        type={\"primary\"}\n                        disabled={!this.state.orderCount}\n                        loading={this.state.loading}>订购</Button>\n                </Popconfirm>\n            </div>\n        </div>\n    }\n}\n\nexport default StockItem;","import React, {Component} from 'react';\n\nclass Balance extends Component {\n\n    updateCurrent = () => {\n        if (this.state.current === this.props.balance) {\n            return;\n        }\n        if (Math.abs(this.state.current - this.props.balance) < 0.01) {\n            this.setState({\n                current: this.props.balance\n            })\n        } else {\n            this.setState({\n                current: this.state.current + (this.props.balance - this.state.current) / 10\n            })\n        }\n    };\n\n    constructor(props, context) {\n        super(props, context);\n        this.state = {current: this.props.balance};\n\n        setInterval(this.updateCurrent, 10);\n    }\n\n    render() {\n        return <div className=\"balance-component\">\n            可用余额 {this.props.balance === null ? <span>...</span> :\n            <span>¥ {(+this.state.current / 100).toFixed(2).replace(/\\d(?=(\\d{3})+\\.)/g, '$&,')}</span>}\n        </div>\n    }\n\n}\n\nexport default Balance;","import axios from 'axios';\nimport {message} from \"antd\";\n\nwindow.backendUrl = window.backendUrl || \"http://127.0.0.1:8080\";\n\nfunction assertResult(result) {\n    if (result.success === false) {\n        throw new Error(\"result.success===false\");\n    }\n}\n\nfunction getBackendUrl(path) {\n    if (window.backendUrl === '/') {\n        window.backendUrl = window.location.origin;\n    }\n    if (window.backendUrl.endsWith(\"/\")) {\n        window.backendUrl = window.backendUrl.substr(0, window.backendUrl.length - 1);\n    }\n\n    if (!path.startsWith(\"/\")) {\n        path = \"/\" + path;\n    }\n\n    return window.backendUrl + path;\n}\n\nexport default {\n    async createUser(userName) {\n        try {\n            const result = (await axios.post(getBackendUrl(\"/createUser\"), {userName})).data;\n            assertResult(result);\n        } catch (e) {\n            message.error(\"Failed to create user: \" + e.message);\n            throw e;\n        }\n    },\n    async query(userName) {\n        try {\n            const result = (await axios.post(getBackendUrl(\"/query\"), {userName})).data;\n            assertResult(result);\n            return result;\n        } catch (e) {\n            message.error(\"Failed to query stock: \" + e.message);\n            throw e;\n        }\n    },\n    async queryBalance(userName) {\n        try {\n            const result = (await axios.post(getBackendUrl(\"/queryBalance\"), {userName})).data;\n            assertResult(result);\n            return result;\n        } catch (e) {\n            message.error(\"Failed to query balance: \" + e.message);\n            throw e;\n        }\n    },\n    async purchase(userName, productCode, count) {\n        try {\n            const result = (await axios.post(getBackendUrl(\"/purchase\"), {userName, productCode, count})).data;\n            assertResult(result);\n            return result;\n        } catch (e) {\n            message.error(\"Failed to purchase: \" + e.message);\n            throw e;\n        }\n    },\n}","import React, {Component} from 'react';\nimport {Breadcrumb, Layout, message, Spin} from 'antd';\nimport StockItem from \"./StockItem\";\nimport Balance from \"./Balance\";\nimport uuid from 'uuid/v4';\nimport Service from './Service'\n\nconst {Header, Content, Footer} = Layout;\n\nclass App extends Component {\n\n    constructor(props, context) {\n        super(props, context);\n        this.state = {balance: null, stockItems: null};\n\n        // auto refresher\n        setInterval(() => {\n            this.refreshStockItems();\n            this.refreshBalance();\n        }, 3000);\n    }\n\n    async componentDidMount() {\n        await App.initUser();\n        this.refreshBalance();\n        await this.refreshStockItems();\n    }\n\n    refreshStockItems = async () => {\n        let items = await Service.query(localStorage[\"userName\"]);\n        items.forEach(item => item.loading = false);\n        this.setState({stockItems: items});\n    };\n\n    refreshBalance = async () => {\n        let result = await Service.queryBalance(localStorage[\"userName\"]);\n        this.setState({balance: result.balance});\n    };\n\n    onOrder = async (item, count) => {\n        await Service.purchase(localStorage[\"userName\"], item.productCode, count);\n        message.success(\"恭喜，订购成功\");\n        this.setState({balance: this.state.balance - item.price * count});\n        item.ownedCount += count;\n        item.loading = true;\n        this.setState({});\n        this.refreshStockItems();\n        this.refreshBalance();\n    };\n\n    render() {\n        return (\n            <Layout className=\"layout\">\n                <Header>\n                    <div className=\"logo\">KubeCon DEMO</div>\n                </Header>\n                <Content style={{padding: '0 50px'}}>\n                    <Breadcrumb style={{margin: '16px 0'}}>\n                        <Breadcrumb.Item>Home</Breadcrumb.Item>\n                        <Breadcrumb.Item>库存管理</Breadcrumb.Item>\n                    </Breadcrumb>\n                    <div style={{background: '#fff', padding: 24, minHeight: 280}}>\n                        {!this.state.stockItems && <div className=\"spin-div\"><Spin/></div>}\n                        {!!this.state.stockItems\n                        && this.state.stockItems.map(item => <div>\n                            <StockItem key={item.productCode}\n                                       name={item.name}\n                                       ownedCount={item.ownedCount}\n                                       price={item.price}\n                                       loading={item.loading}\n                                       onOrder={(count) => this.onOrder(item, count)}/>\n                        </div>)}\n\n                    </div>\n                </Content>\n\n                <Balance balance={this.state.balance}/>\n                <Footer style={{textAlign: 'center'}}>Alipay ©2019 / a KubeCon DEMO</Footer>\n            </Layout>\n        );\n    }\n\n    static async initUser() {\n        const userName = localStorage[\"userName\"];\n        if (!userName) {\n            let userName = uuid();\n            await Service.createUser(userName);\n            localStorage[\"userName\"] = userName;\n            // message.success(\"已成功初始化新的用户。\");\n        }\n    }\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}